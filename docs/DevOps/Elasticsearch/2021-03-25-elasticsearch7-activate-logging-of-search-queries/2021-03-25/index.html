<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-DevOps/Elasticsearch/2021-03-25-elasticsearch7-activate-logging-of-search-queries/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Log all the searches going through Elasticsearch | Mike Polinowski</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://mpolinowski.github.io/docs/DevOps/Elasticsearch/2021-03-25-elasticsearch7-activate-logging-of-search-queries/2021-03-25"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Log all the searches going through Elasticsearch | Mike Polinowski"><meta data-rh="true" name="description" content="Bakhtapur, Nepal"><meta data-rh="true" property="og:description" content="Bakhtapur, Nepal"><link data-rh="true" rel="icon" href="/img/icons/favicon-32x32.png"><link data-rh="true" rel="canonical" href="https://mpolinowski.github.io/docs/DevOps/Elasticsearch/2021-03-25-elasticsearch7-activate-logging-of-search-queries/2021-03-25"><link data-rh="true" rel="alternate" href="https://mpolinowski.github.io/docs/DevOps/Elasticsearch/2021-03-25-elasticsearch7-activate-logging-of-search-queries/2021-03-25" hreflang="en"><link data-rh="true" rel="alternate" href="https://mpolinowski.github.io/docs/DevOps/Elasticsearch/2021-03-25-elasticsearch7-activate-logging-of-search-queries/2021-03-25" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Mike Polinowski RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Mike Polinowski Atom Feed">




<link rel="icon" href="/img/angular_momentum.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(37,194,160)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/img/angular_momentum.png">
<link rel="mask-icon" href="/img/angular_momentum.png" color="rgb(33,33,33)">
<meta name="msapplication-TileImage" content="/img/angular_momentum.png">
<meta name="msapplication-TileColor" content="#000">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-P74BDWF0C6"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-P74BDWF0C6",{})</script><link rel="stylesheet" href="/assets/css/styles.08c8c484.css">
<script src="/assets/js/runtime~main.44936bfb.js" defer="defer"></script>
<script src="/assets/js/main.52bb09c2.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/angular_momentum.png" alt="Mike Polinowski :: Dev Notebook" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/angular_momentum.png" alt="Mike Polinowski :: Dev Notebook" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Mike Polinowski</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs/tags">Tags</a><a class="navbar__item navbar__link" href="/Search">Search</a><a href="https://mpolinowski.github.io/Personal" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">About<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/mpolinowski" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/development">Development</a><button aria-label="Expand sidebar category &#x27;Development&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/devops">DevOps</a><button aria-label="Collapse sidebar category &#x27;DevOps&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/hashicorp">Hashicorp</a><button aria-label="Expand sidebar category &#x27;Hashicorp&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/zabbix">Zabbix</a><button aria-label="Expand sidebar category &#x27;Zabbix&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/server-provisioning">Server Provisioning</a><button aria-label="Expand sidebar category &#x27;Server Provisioning&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/gitops">GitOps</a><button aria-label="Expand sidebar category &#x27;GitOps&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/kubernetes">Kubernetes</a><button aria-label="Expand sidebar category &#x27;Kubernetes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/nginx">NGINX</a><button aria-label="Expand sidebar category &#x27;NGINX&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/elasticsearch">Elasticsearch</a><button aria-label="Collapse sidebar category &#x27;Elasticsearch&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2023-02-10--meili-rusty-elastic-docker/2023-02-10">Introduction to MeiLi Search with Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2022-10-12--opensearch-rest-api/2022-10-12">Opensearch Rest API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2022-10-11--opensearch-docker-compose/2022-10-11">Opensearch &amp; Dashboard</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2022-02-06--elasticsearch-v8-data-ingestion-apache/2022-02-06">Elasticsearch v8, Filebeat (Docker) and Apache</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2022-02-05--kibana-v8-index-management/2022-02-05">Elasticsearch &amp; Kibana v8 Index Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2022-02-04--kibana-v8-search-queries/2022-02-04">Elasticsearch &amp; Kibana v8 Search Cheat Sheet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2022-02-03--elasticsearch-v8-data-ingestion/2022-02-03">Elasticsearch v8, Filebeat (Docker) and NGINX</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2022-02-02--elasticsearch-v8-upgrade/2022-02-02">Performing an Elasticsearch v8 Upgrade</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2021-04-01-elastic-filebeats-for-nginx-logs/2021-04-01">Elastic Filebeat and NGINX Access Logs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2021-03-31-elastic-filebeats-for-apache-logs/2021-03-31">Elastic Filebeat and Apache Access Logs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2021-03-30-elasticsearch7-and-filebeats/2021-03-30">Elasticsearch 7 and Filebeats</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2021-03-29-elasticsearch7-data-transformations/2021-03-29">Elasticsearch 7 Data Transformation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2021-03-28-elasticsearch7-timeseries/2021-03-28">Elasticsearch 7 Timeseries</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2021-03-27-elasticsearch7-aggregations/2021-03-27">Elasticsearch 7 Aggregations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2021-03-26-elasticsearch7-for-syslog-messages/2021-03-26">Elasticsearch 7 to log Linux System Events</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible menu__list-item-collapsible--active"><a class="menu__link menu__link--sublist menu__link--active" aria-current="page" aria-expanded="true" tabindex="0" href="/docs/DevOps/Elasticsearch/2021-03-25-elasticsearch7-activate-logging-of-search-queries/2021-03-25">Log all the searches going through Elasticsearch</a><button aria-label="Collapse sidebar category &#x27;Log all the searches going through Elasticsearch&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2021-03-25-elasticsearch7-activate-logging-of-search-queries/elasticsearch-cheat-sheet">Elasticsearch Cheat Sheet</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2021-03-24-logstash-common-grok-pattern/2021-03-24">Logstash 7 and Common Log Pattern</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2021-03-23-logstash-working-with-unstructured-data/2021-03-23">Logstash 7 Working with Unstructured Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2021-03-22-logstash-working-with-structured-data/2021-03-22">Logstash 7 Working with Structured Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2021-03-21-logstash-digesting-data/2021-03-21">Logstash 7 Digesting Webserver Logs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2021-03-20-elasticsearch-7-refresher/2021-03-20">Elasticsearch 7 Refresher</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2020-06-01--elasticsearch-docker/2020-06-01">Elasticsearch in Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2019-09-08--elasticsearch_7-5_docker/2019-09-08">Elasticsearch 7 with Docker Compose</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2018-01-01--securing-elasticsearch-readonlyrest/2018-01-01">Securing Elasticsearch with ReadOnlyREST</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2017-12-31--securing-elasticsearch-xpack/2017-12-31">Securing Elasticsearch with X-Pack</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2017-12-26--elasticsearch-kibana/2017-12-16">Elasticsearch and Kibana</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2017-12-05--elasticsearch-react-example/2017-12-05">React Search Interface</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2017-10-03--search-engine-setup-and-configuration/2017-10-03">Search Engine Setup and Configuration</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/ansible">Ansible</a><button aria-label="Expand sidebar category &#x27;Ansible&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/server-security">Server Security</a><button aria-label="Expand sidebar category &#x27;Server Security&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/linux">Linux</a><button aria-label="Expand sidebar category &#x27;Linux&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/windows">Windows</a><button aria-label="Expand sidebar category &#x27;Windows&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/tomcat">Tomcat</a><button aria-label="Expand sidebar category &#x27;Tomcat&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/salt">Salt</a><button aria-label="Expand sidebar category &#x27;Salt&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/machine-learning-ai-and-computer-vision">Machine Learning, AI and Computer Vision</a><button aria-label="Expand sidebar category &#x27;Machine Learning, AI and Computer Vision&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/automation-deep-vision-and-robotics">Automation, Deep Vision and Robotics</a><button aria-label="Expand sidebar category &#x27;Automation, Deep Vision and Robotics&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/devops"><span itemprop="name">DevOps</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/elasticsearch"><span itemprop="name">Elasticsearch</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Log all the searches going through Elasticsearch</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Log all the searches going through Elasticsearch</h1></header><p><img alt="Bakhtapur, Nepal" src="/assets/images/photo-456tdsfggd_67gfh6dgdf4_d-ce46b6b3b5abb2f099879ac2721568d8.jpg" width="1500" height="542"></p>
<ul>
<li><a href="#enable-logging-of-all-searches">Enable logging of all searches</a></li>
<li><a href="#inspecting-the-logs">Inspecting the logs</a></li>
<li><a href="#disable-logging-of-all-searches">Disable logging of all searches</a></li>
<li><a href="#logging-indexing-requests">Logging Indexing Requests</a></li>
<li><a href="#working-on-the-live-system">Working on the Live System</a>
<ul>
<li><a href="#activate-the-search-query-logging">Activate the search query logging</a></li>
<li><a href="#check-that-the-logging-is-active">Check that the logging is active</a></li>
</ul>
</li>
</ul>
<p>I always wondered why there is no one-button-solution in Kibana to log all searches and indexation requests sent to Elasticsearch in the engine log file. It would be very helpful to see what users are searching for to add new tags:[keywords] to articles that will position the &quot;correct&quot; article more prominent based on the search queries that are used.</p>
<h2 id="enable-logging-of-all-searches">Enable logging of all searches</h2>
<p>We are going to leverage the <strong>slowlog</strong> functionality.  The <strong>slowlog</strong> functions logs everything that takes to long to be processed. Since search queries are usually fast they tend not to show up. But we can lower the threshold making sure that they will be recorded. I am working with an index <code>apache-access-log</code> that was created earlier. To change the settings for this index run the following command in Kibana:</p>
<pre><code class="language-json">PUT apache-access-log/_settings
{
  &quot;index.search.slowlog.threshold.query.trace&quot;: &quot;0s&quot;,
  &quot;index.search.slowlog.level&quot;: &quot;trace&quot;
}
</code></pre>
<p>I am running a search query in Kibana for the IP address `49.149.224.133``and get 17 hits:</p>
<p><img alt="Elasticeasrch Log Search Queries" src="/assets/images/Elasticeasrch_Log_Search_Queries_01-35eb76128679470ab70e4dbfc53c4b6b.png" width="1505" height="909"></p>
<h2 id="inspecting-the-logs">Inspecting the logs</h2>
<p>My Elasticsearch container is running under the name <code>elasticsearch</code>. To check it&#x27;s logs I need to run the following command:</p>
<pre><code class="language-bash">docker logs elasticsearch
</code></pre>
<p>And the log file shows a new entry at the bottom - this is our search query:</p>
<pre><code class="language-json">{&quot;type&quot;: &quot;index_search_slowlog&quot;, &quot;timestamp&quot;: &quot;2021-08-04T05:37:26,667Z&quot;, &quot;level&quot;: &quot;TRACE&quot;, &quot;component&quot;: &quot;i.s.s.query&quot;, &quot;cluster.name&quot;: &quot;docker-cluster&quot;, &quot;node.name&quot;: &quot;debian11&quot;, &quot;message&quot;: &quot;[apache-access-log][0]&quot;, &quot;took&quot;: &quot;21.5ms&quot;, &quot;took_millis&quot;: &quot;21&quot;, &quot;total_hits&quot;: &quot;16 hits&quot;, &quot;types&quot;: &quot;[]&quot;, &quot;stats&quot;: &quot;[]&quot;, &quot;search_type&quot;: &quot;QUERY_THEN_FETCH&quot;, &quot;total_shards&quot;: &quot;1&quot;, &quot;source&quot;: &quot;{\&quot;size\&quot;:500,\&quot;query\&quot;:{\&quot;bool\&quot;:{\&quot;filter\&quot;:[{\&quot;multi_match\&quot;:{\&quot;query\&quot;:\&quot;49.149.224.133\&quot;,\&quot;fields\&quot;:[],\&quot;type\&quot;:\&quot;best_fields\&quot;,\&quot;operator\&quot;:\&quot;OR\&quot;,\&quot;slop\&quot;:0,\&quot;prefix_length\&quot;:0,\&quot;max_expansions\&quot;:50,\&quot;lenient\&quot;:true,\&quot;zero_terms_query\&quot;:\&quot;NONE\&quot;,\&quot;auto_generate_synonyms_phrase_query\&quot;:true,\&quot;fuzzy_transpositions\&quot;:true,\&quot;boost\&quot;:1.0}}],\&quot;adjust_pure_negative\&quot;:true,\&quot;boost\&quot;:1.0}},\&quot;version\&quot;:true,\&quot;_source\&quot;:false,\&quot;stored_fields\&quot;:\&quot;*\&quot;,\&quot;fields\&quot;:[{\&quot;field\&quot;:\&quot;*\&quot;,\&quot;include_unmapped\&quot;:true},{\&quot;field\&quot;:\&quot;@timestamp\&quot;,\&quot;format\&quot;:\&quot;strict_date_optional_time\&quot;},{\&quot;field\&quot;:\&quot;read_timestamp\&quot;,\&quot;format\&quot;:\&quot;strict_date_optional_time\&quot;}],\&quot;script_fields\&quot;:{},\&quot;sort\&quot;:[{\&quot;_score\&quot;:{\&quot;order\&quot;:\&quot;desc\&quot;}}],\&quot;track_total_hits\&quot;:2147483647,\&quot;highlight\&quot;:{\&quot;pre_tags\&quot;:[\&quot;@kibana-highlighted-field@\&quot;],\&quot;post_tags\&quot;:[\&quot;@/kibana-highlighted-field@\&quot;],\&quot;fragment_size\&quot;:2147483647,\&quot;fields\&quot;:{\&quot;*\&quot;:{}}}}&quot;, &quot;id&quot;: &quot;292795eb-82df-4bee-858d-254e4a1192d7&quot;, &quot;cluster.uuid&quot;: &quot;InACjldtRnu-vUy85P4txw&quot;, &quot;node.id&quot;: &quot;MsvdkSEdRBmBUftW7CciIw&quot;  }
</code></pre>
<p>The part we want is inside the <strong>source field</strong>. As it is JSON inside a JSON itâ€™s escaped, we just need to replace <code>\&quot;</code> by <code>&quot;</code> and we are good to go:</p>
<pre><code class="language-json">&quot;{&quot;size&quot;:500,&quot;query&quot;:{&quot;bool&quot;:{&quot;filter&quot;:[{&quot;multi_match&quot;:{&quot;query&quot;:&quot;49.149.224.133&quot;,&quot;fields&quot;:[],&quot;type&quot;:&quot;best_fields&quot;,&quot;operator&quot;:&quot;OR&quot;,&quot;slop&quot;:0,&quot;prefix_length&quot;:0,&quot;max_expansions&quot;:50,&quot;lenient&quot;:true,&quot;zero_terms_query&quot;:&quot;NONE&quot;,&quot;auto_generate_synonyms_phrase_query&quot;:true,&quot;fuzzy_transpositions&quot;:true,&quot;boost&quot;:1.0}}],&quot;adjust_pure_negative&quot;:true,&quot;boost&quot;:1.0}},&quot;version&quot;:true,&quot;_source&quot;:false,&quot;stored_fields&quot;:&quot;*&quot;,&quot;fields&quot;:[{&quot;field&quot;:&quot;*&quot;,&quot;include_unmapped&quot;:true},{&quot;field&quot;:&quot;@timestamp&quot;,&quot;format&quot;:&quot;strict_date_optional_time&quot;},{&quot;field&quot;:&quot;read_timestamp&quot;,&quot;format&quot;:&quot;strict_date_optional_time&quot;}],&quot;script_fields&quot;:{},&quot;sort&quot;:[{&quot;_score&quot;:{&quot;order&quot;:&quot;desc&quot;}}],&quot;track_total_hits&quot;:2147483647,&quot;highlight&quot;:{&quot;pre_tags&quot;:[&quot;@kibana-highlighted-field@&quot;],&quot;post_tags&quot;:[&quot;@/kibana-highlighted-field@&quot;],&quot;fragment_size&quot;:2147483647,&quot;fields&quot;:{&quot;*&quot;:{}}}}&quot;
</code></pre>
<p>I copy the logfile to <code>/opt/logstash/elasticsearch.log</code> and use the following Logstash configuration to ingest the log into Elasticsearch <code>/opt/logstash/pipeline/logstash.conf</code>:</p>
<pre><code class="language-json">input {
  file {
    path =&gt; &quot;/usr/share/logstash/elasticsearch.log&quot;
    start_position =&gt; &quot;beginning&quot;
    sincedb_path =&gt; &quot;/dev/null&quot;
  }
}
filter {
  json {
      source =&gt; &quot;message&quot;
  }
}
output {
   elasticsearch {
     hosts =&gt; &quot;http://localhost:9200&quot;
     index =&gt; &quot;elasticsearch-log&quot;
  }

stdout {}

}
</code></pre>
<p>And run Logstash with the new configuration file:</p>
<pre><code class="language-bash">docker run \
   --name logstash \
   --net=host \
   --rm -it \
   -v /opt/logstash/pipeline/logstash.conf:/usr/share/logstash/pipeline/logstash.conf \
   -v /opt/logstash/elasticsearch.log:/usr/share/logstash/elasticsearch.log \
   -e &quot;ELASTIC_HOST=localhost:9200&quot; \
   -e &quot;XPACK_SECURITY_ENABLED=false&quot; \
   -e &quot;XPACK_REPORTING_ENABLED=false&quot; \
   -e &quot;XPACK_MONITORING_ENABLED=false&quot; \
   -e &quot;XPACK_MONITORING_ELASTICSEARCH_USERNAME=elastic&quot; \
   -e &quot;XPACK_MONITORING_ELASTICSEARCH_PASSWORD=changeme&quot; \
   logstash:7.13.4
</code></pre>
<p>This will give me the following result:</p>
<pre><code class="language-json">{
          &quot;source&quot; =&gt; &quot;{\&quot;size\&quot;:500,\&quot;query\&quot;:{\&quot;bool\&quot;:{\&quot;filter\&quot;:[{\&quot;multi_match\&quot;:{\&quot;query\&quot;:\&quot;49.149.224.133\&quot;,\&quot;fields\&quot;:[],\&quot;type\&quot;:\&quot;best_fields\&quot;,\&quot;operator\&quot;:\&quot;OR\&quot;,\&quot;slop\&quot;:0,\&quot;prefix_length\&quot;:0,\&quot;max_expansions\&quot;:50,\&quot;lenient\&quot;:true,\&quot;zero_terms_query\&quot;:\&quot;NONE\&quot;,\&quot;auto_generate_synonyms_phrase_query\&quot;:true,\&quot;fuzzy_transpositions\&quot;:true,\&quot;boost\&quot;:1.0}}],\&quot;adjust_pure_negative\&quot;:true,\&quot;boost\&quot;:1.0}},\&quot;version\&quot;:true,\&quot;_source\&quot;:false,\&quot;stored_fields\&quot;:\&quot;*\&quot;,\&quot;fields\&quot;:[{\&quot;field\&quot;:\&quot;*\&quot;,\&quot;include_unmapped\&quot;:true},{\&quot;field\&quot;:\&quot;@timestamp\&quot;,\&quot;format\&quot;:\&quot;strict_date_optional_time\&quot;},{\&quot;field\&quot;:\&quot;read_timestamp\&quot;,\&quot;format\&quot;:\&quot;strict_date_optional_time\&quot;}],\&quot;script_fields\&quot;:{},\&quot;sort\&quot;:[{\&quot;_score\&quot;:{\&quot;order\&quot;:\&quot;desc\&quot;}}],\&quot;track_total_hits\&quot;:2147483647,\&quot;highlight\&quot;:{\&quot;pre_tags\&quot;:[\&quot;@kibana-highlighted-field@\&quot;],\&quot;post_tags\&quot;:[\&quot;@/kibana-highlighted-field@\&quot;],\&quot;fragment_size\&quot;:2147483647,\&quot;fields\&quot;:{\&quot;*\&quot;:{}}}}&quot;,
           &quot;level&quot; =&gt; &quot;TRACE&quot;,
       &quot;component&quot; =&gt; &quot;i.s.s.query&quot;,
            &quot;path&quot; =&gt; &quot;/usr/share/logstash/elasticsearch.log&quot;,
            &quot;type&quot; =&gt; &quot;index_search_slowlog&quot;,
         &quot;node.id&quot; =&gt; &quot;MsvdkSEdRBmBUftW7CciIw&quot;,
            &quot;took&quot; =&gt; &quot;21.5ms&quot;,
      &quot;@timestamp&quot; =&gt; 2021-08-04T09:32:57.956Z,
            &quot;host&quot; =&gt; &quot;debian11&quot;,
       &quot;node.name&quot; =&gt; &quot;debian11&quot;,
       &quot;timestamp&quot; =&gt; &quot;2021-08-04T05:37:26,667Z&quot;,
           &quot;types&quot; =&gt; &quot;[]&quot;,
      &quot;total_hits&quot; =&gt; &quot;16 hits&quot;,
              &quot;id&quot; =&gt; &quot;292795eb-82df-4bee-858d-254e4a1192d7&quot;,
         &quot;message&quot; =&gt; &quot;[apache-access-log][0]&quot;,
    &quot;cluster.uuid&quot; =&gt; &quot;InACjldtRnu-vUy85P4txw&quot;,
           &quot;stats&quot; =&gt; &quot;[]&quot;,
        &quot;@version&quot; =&gt; &quot;1&quot;,
    &quot;total_shards&quot; =&gt; &quot;1&quot;,
     &quot;search_type&quot; =&gt; &quot;QUERY_THEN_FETCH&quot;,
     &quot;took_millis&quot; =&gt; &quot;21&quot;,
    &quot;cluster.name&quot; =&gt; &quot;docker-cluster&quot;
}
</code></pre>
<p>Now instead of removing all the lines that I don&#x27;t need explicitly:</p>
<pre><code class="language-json">mutate {
    remove_field =&gt; [&quot;level&quot;, &quot;@timestamp&quot;, &quot;path&quot;, &quot;host&quot;, &quot;@version&quot; ...]
  }
</code></pre>
<p>I want to <a href="https://www.elastic.co/guide/en/logstash/current/plugins-filters-prune.html">use a whitelist to prune everything</a> BUT the <code>source</code> field:</p>
<pre><code class="language-json">input {
    file {
      path =&gt; &quot;/usr/share/logstash/elasticsearch.log&quot;
      start_position =&gt; &quot;beginning&quot;
      sincedb_path =&gt; &quot;/dev/null&quot;
    }
  }
  filter {
    json {
        source =&gt; &quot;message&quot;
    }
    prune {
          interpolate =&gt; false
          whitelist_names =&gt; [&quot;source&quot;]
    }
    ruby {
      code =&gt; &quot;
        # Recursively remove `nil`s and empty objects from event
        def remove_nils!(hash)
          hash.each do |k, v|
            if v.nil?
              hash.delete(k)
            elsif v.is_a?(Hash)
              if v.empty?
                hash.delete(k)
              else
                result = remove_nils!(v)
                if result.empty?
                  hash.delete(k)
                else
                  hash[k] = result
                end
              end
            end
          end
        end
        event_hash = event.to_hash
        event.cancel
        # This one could be improved, stay tuned!
        new_event_block.call(
          LogStash::Event.new(
            remove_nils!(event_hash)
          )
        )
        &quot;
    }
  }
  output {
     elasticsearch {
       hosts =&gt; &quot;http://localhost:9200&quot;
       index =&gt; &quot;elasticsearch-log&quot;
    }
  
  stdout {}
  
  }
</code></pre>
<p>To delete the indexed data and re-run run Logstash with the new configuration:</p>
<pre><code class="language-bash">curl -XDELETE -u elastic:changeme http://localhost:9200/elasticsearch-log
</code></pre>
<p>Note that &quot;nasty bit&quot; in the configuration named ruby I added because the pruning process left me with a lot of empty <code>{}</code> outputs. I wanted to remove them... but it is not exactly working the way I want. I will have to get back to this later. But the important result is a cleaned up output:</p>
<pre><code class="language-json">{
      &quot;@version&quot; =&gt; &quot;1&quot;,
      &quot;@timestamp&quot; =&gt; 2021-08-04T10:13:52.032Z,
      &quot;source&quot; =&gt; &quot;{\&quot;size\&quot;:500,\&quot;query\&quot;:{\&quot;bool\&quot;:{\&quot;filter\&quot;:[{\&quot;multi_match\&quot;:{\&quot;query\&quot;:\&quot;49.149.224.133\&quot;,\&quot;fields\&quot;:[],\&quot;type\&quot;:\&quot;best_fields\&quot;,\&quot;operator\&quot;:\&quot;OR\&quot;,\&quot;slop\&quot;:0,\&quot;prefix_length\&quot;:0,\&quot;max_expansions\&quot;:50,\&quot;lenient\&quot;:true,\&quot;zero_terms_query\&quot;:\&quot;NONE\&quot;,\&quot;auto_generate_synonyms_phrase_query\&quot;:true,\&quot;fuzzy_transpositions\&quot;:true,\&quot;boost\&quot;:1.0}}],\&quot;adjust_pure_negative\&quot;:true,\&quot;boost\&quot;:1.0}},\&quot;version\&quot;:true,\&quot;_source\&quot;:false,\&quot;stored_fields\&quot;:\&quot;*\&quot;,\&quot;fields\&quot;:[{\&quot;field\&quot;:\&quot;*\&quot;,\&quot;include_unmapped\&quot;:true},{\&quot;field\&quot;:\&quot;@timestamp\&quot;,\&quot;format\&quot;:\&quot;strict_date_optional_time\&quot;},{\&quot;field\&quot;:\&quot;read_timestamp\&quot;,\&quot;format\&quot;:\&quot;strict_date_optional_time\&quot;}],\&quot;script_fields\&quot;:{},\&quot;sort\&quot;:[{\&quot;_score\&quot;:{\&quot;order\&quot;:\&quot;desc\&quot;}}],\&quot;track_total_hits\&quot;:2147483647,\&quot;highlight\&quot;:{\&quot;pre_tags\&quot;:[\&quot;@kibana-highlighted-field@\&quot;],\&quot;post_tags\&quot;:[\&quot;@/kibana-highlighted-field@\&quot;],\&quot;fragment_size\&quot;:2147483647,\&quot;fields\&quot;:{\&quot;*\&quot;:{}}}}&quot;
}
</code></pre>
<h2 id="disable-logging-of-all-searches">Disable logging of all searches</h2>
<p>To go back to the default configuration:</p>
<pre><code class="language-json">PUT foobar/_settings
{
  &quot;index.search.slowlog.threshold.query.trace&quot;: &quot;500ms&quot;,
  &quot;index.search.slowlog.level&quot;: &quot;info&quot;
}
</code></pre>
<h2 id="logging-indexing-requests">Logging Indexing Requests</h2>
<p>This is less common but we can do the same with the indexing options. Enabling slowlog with full source (warning this can be heavy):</p>
<pre><code class="language-json">PUT foobar/_settings
{
  &quot;index.indexing.slowlog.threshold.index.trace&quot;: &quot;0s&quot;,
  &quot;index.indexing.slowlog.level&quot;: &quot;trace&quot;,
  &quot;index.indexing.slowlog.source&quot;: true
}
</code></pre>
<p>Getting back to the defaults:</p>
<pre><code class="language-json">PUT foobar/_settings
{
  &quot;index.indexing.slowlog.threshold.index.trace&quot;: &quot;500ms&quot;,
  &quot;index.indexing.slowlog.level&quot;: &quot;info&quot;,
  &quot;index.indexing.slowlog.source&quot;: &quot;1000&quot;
}
</code></pre>
<h2 id="working-on-the-live-system">Working on the Live System</h2>
<h3 id="activate-the-search-query-logging">Activate the search query logging</h3>
<pre><code class="language-json">PUT index_2021_06_07/_settings
{
  &quot;index.search.slowlog.threshold.query.trace&quot;: &quot;0s&quot;,
  &quot;index.search.slowlog.level&quot;: &quot;trace&quot;
}
</code></pre>
<h3 id="check-that-the-logging-is-active">Check that the logging is active</h3>
<pre><code class="language-bash">tail -f `docker inspect --format=&#x27;{{.LogPath}}&#x27; elasticsearch_container`
</code></pre>
<p>This command (replace the container name with the name of your Elasticsearch container) will print out log entries as they are written to the Elasticsearch logfile. Now run a search from your web frontend - it should show up like this:  <code>{&quot;multi_match&quot;:{&quot;query&quot;: &quot;My Search Query&quot;,</code></p>
<pre><code class="language-bash">{&quot;log&quot;:&quot;{\&quot;type\&quot;: \&quot;index_search_slowlog\&quot;, \&quot;timestamp\&quot;: \&quot;2021-08-04T14:02:06,307Z\&quot;, \&quot;level\&quot;: \&quot;TRACE\&quot;, \&quot;component\&quot;: \&quot;i.s.s.query\&quot;, \&quot;cluster.name\&quot;: \&quot;docker-cluster\&quot;, \&quot;node.name\&quot;: \&quot;9954f7648983\&quot;, \&quot;message\&quot;: \&quot;[index_2021_06_07][0]\&quot;, \&quot;took\&quot;: \&quot;1.6ms\&quot;, \&quot;took_millis\&quot;: \&quot;1\&quot;, \&quot;total_hits\&quot;: \&quot;272 hits\&quot;, \&quot;types\&quot;: \&quot;[\\\&quot;_doc\\\&quot;]\&quot;, \&quot;stats\&quot;: \&quot;[]\&quot;, \&quot;search_type\&quot;: \&quot;QUERY_THEN_FETCH\&quot;, \&quot;total_shards\&quot;: \&quot;1\&quot;, \&quot;source\&quot;: \&quot;{\\\&quot;from\\\&quot;:0,\\\&quot;size\\\&quot;:5,\\\&quot;query\\\&quot;:{\\\&quot;bool\\\&quot;:{\\\&quot;must\\\&quot;:[{\\\&quot;bool\\\&quot;:{\\\&quot;must\\\&quot;:[{\\\&quot;bool\\\&quot;:{\\\&quot;should\\\&quot;:[{\\\&quot;multi_match\\\&quot;:{\\\&quot;query\\\&quot;:\\\&quot;Port Weiterleitung AVM Fritzbox\\\&quot;,\\\&quot;fields\\\&quot;:[\\\&quot;abstract^5.0\\\&quot;,\\\&quot;description^3.0\\\&quot;,\\\&quot;tags^10.0\\\&quot;,\\\&quot;title^8.0\\\&quot;],\\\&quot;type\\\&quot;:\\\&quot;best_fields\\\&quot;,\\\&quot;operator\\\&quot;:\\\&quot;OR\\\&quot;,\\\&quot;slop\\\&quot;:0,\\\&quot;fuzziness\\\&quot;:\\\&quot;1\\\&quot;,\\\&quot;prefix_length\\\&quot;:0,\\\&quot;max_expansions\\\&quot;:50,\\\&quot;zero_terms_query\\\&quot;:\\\&quot;NONE\\\&quot;,\\\&quot;auto_generate_synonyms_phrase_query\\\&quot;:true,\\\&quot;fuzzy_transpositions\\\&quot;:true,\\\&quot;boost\\\&quot;:1.0}},{\\\&quot;multi_match\\\&quot;:{\\\&quot;query\\\&quot;:\\\&quot;Port Weiterleitung AVM Fritzbox\\\&quot;,\\\&quot;fields\\\&quot;:[\\\&quot;abstract^5.0\\\&quot;,\\\&quot;description^3.0\\\&quot;,\\\&quot;tags^10.0\\\&quot;,\\\&quot;title^8.0\\\&quot;],\\\&quot;type\\\&quot;:\\\&quot;phrase\\\&quot;,\\\&quot;operator\\\&quot;:\\\&quot;OR\\\&quot;,\\\&quot;slop\\\&quot;:0,\\\&quot;prefix_length\\\&quot;:0,\\\&quot;max_expansions\\\&quot;:50,\\\&quot;zero_terms_query\\\&quot;:\\\&quot;NONE\\\&quot;,\\\&quot;auto_generate_synonyms_phrase_query\\\&quot;:true,\\\&quot;fuzzy_transpositions\\\&quot;:true,\\\&quot;boost\\\&quot;:1.0}}],\\\&quot;adjust_pure_negative\\\&quot;:true,\\\&quot;minimum_should_match\\\&quot;:\\\&quot;1\\\&quot;,\\\&quot;boost\\\&quot;:1.0}}],\\\&quot;adjust_pure_negative\\\&quot;:true,\\\&quot;boost\\\&quot;:1.0}}],\\\&quot;adjust_pure_negative\\\&quot;:true,\\\&quot;boost\\\&quot;:1.0}},\\\&quot;_source\\\&quot;:{\\\&quot;includes\\\&quot;:[\\\&quot;*\\\&quot;],\\\&quot;excludes\\\&quot;:[]}}\&quot;, \&quot;cluster.uuid\&quot;: \&quot;1F9RN9roSXqf1sa2Sam7yQ\&quot;, \&quot;node.id\&quot;: \&quot;bFc0o2JrTBqG0zf9Wydh3g\&quot;  }\n&quot;,&quot;stream&quot;:&quot;stdout&quot;,&quot;time&quot;:&quot;2021-08-04T14:02:06.311539637Z&quot;}
</code></pre>
<p>Now I am going to check the file location of my ES container log:</p>
<pre><code class="language-bash">docker inspect --format=&#x27;{{.LogPath}}&#x27; elasticsearch_container

/var/lib/docker/containers/9954f76489836bf3def6cc49605f533439431dbcb5e06914eb457055fad54ebf/9954f76489836bf3def6cc49605f533439431dbcb5e06914eb457055fad54ebf-json.log                                       
</code></pre>
<p>I copied the file and cleaned it up - removed all those annoying back-slashes! Also removed a few things trying to make the Log valid JSON... but what a mess those logs are! Really not happy with that.</p>
<p>Let&#x27;s run Logstash with a regular Structured Data / JSON configuration and see what happens:</p>
<pre><code class="language-json">input {
  file {
    path =&gt; &quot;/usr/share/logstash/wiki_elasticseach_2021-08-05.json&quot;
    start_position =&gt; &quot;beginning&quot;
    sincedb_path =&gt; &quot;/dev/null&quot;
  }
}
filter {
  json {
      source =&gt; &quot;message&quot;
  }
}
output {
   elasticsearch {
     hosts =&gt; &quot;http://localhost:9200&quot;
     index =&gt; &quot;elasticsearch-log-json&quot;
  }

stdout {}

}
</code></pre>
<pre><code class="language-bash">docker run \
   --name logstash \
   --net=host \
   --rm -it \
   -v /opt/logstash/pipeline/logstash.conf:/usr/share/logstash/pipeline/logstash.conf \
   -v /opt/logstash/wiki_elasticseach_2021-08-05.json:/usr/share/logstash/wiki_elasticseach_2021-08-05.json \
   -e &quot;ELASTIC_HOST=localhost:9200&quot; \
   -e &quot;XPACK_SECURITY_ENABLED=false&quot; \
   -e &quot;XPACK_REPORTING_ENABLED=false&quot; \
   -e &quot;XPACK_MONITORING_ENABLED=false&quot; \
   -e &quot;XPACK_MONITORING_ELASTICSEARCH_USERNAME=elastic&quot; \
   -e &quot;XPACK_MONITORING_ELASTICSEARCH_PASSWORD=changeme&quot; \
   logstash:7.13.4
</code></pre>
<p><img alt="Elasticeasrch Log Search Queries" src="/assets/images/Elasticeasrch_Log_Search_Queries_02-5a30444fe043feb66fe4c5cbf41bdcec.png" width="1489" height="567"></p>
<p>To delete the indexed data:</p>
<pre><code class="language-bash">curl -XDELETE -u elastic:changeme http://localhost:9200/elasticsearch-log-json
</code></pre>
<p>I found the Docker Log hard to work with. I might try to activate the Elasticsearch SlowLog directly. Currently the ES instance logs to STDOUT and Docker writes it to file. So I end up with two structures wrapped around each other. Also the ES does not separate to different log files this way - everything is just one big blob of broken JSON.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/linux">LINUX</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/elasticsearch">Elasticsearch</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Elasticsearch/2021-03-25-elasticsearch7-activate-logging-of-search-queries/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/DevOps/Elasticsearch/2021-03-26-elasticsearch7-for-syslog-messages/2021-03-26"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Elasticsearch 7 to log Linux System Events</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/DevOps/Elasticsearch/2021-03-25-elasticsearch7-activate-logging-of-search-queries/elasticsearch-cheat-sheet"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Elasticsearch Cheat Sheet</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#enable-logging-of-all-searches" class="table-of-contents__link toc-highlight">Enable logging of all searches</a></li><li><a href="#inspecting-the-logs" class="table-of-contents__link toc-highlight">Inspecting the logs</a></li><li><a href="#disable-logging-of-all-searches" class="table-of-contents__link toc-highlight">Disable logging of all searches</a></li><li><a href="#logging-indexing-requests" class="table-of-contents__link toc-highlight">Logging Indexing Requests</a></li><li><a href="#working-on-the-live-system" class="table-of-contents__link toc-highlight">Working on the Live System</a><ul><li><a href="#activate-the-search-query-logging" class="table-of-contents__link toc-highlight">Activate the search query logging</a></li><li><a href="#check-that-the-logging-is-active" class="table-of-contents__link toc-highlight">Check that the logging is active</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Research</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Notebook</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tags">Tags</a></li><li class="footer__item"><a class="footer__link-item" href="/Curriculum-Vitae">CV</a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/in/mike-polinowski-6396ba121/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/MikePolinowski" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.flickr.com/people/149680084@N06/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flickr<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/mpolinowski" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2024 Mike Polinowski, INSTAR Deutschland GmbH, Shenzhen - China.</div></div></div></footer></div>
</body>
</html>